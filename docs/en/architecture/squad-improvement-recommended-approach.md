# Recommended Approach: Squad Improvement System

**Generated:** 2025-12-26
**Generated By:** @architect (Aria)
**Feature:** Squad Analysis & Continuous Improvement Tasks
**Proposed Story:** SQS-11

---

## Feature Requirements

**Description:** Create tasks for analyzing existing squads and adding/modifying components incrementally, enabling continuous improvement of squads without recreating them.

**API Integration Required:** No
**Database Changes Required:** No

---

## Proposed New Tasks

### 1. `*analyze-squad` - Analyze Existing Squad

**Purpose:** Scan and analyze an existing squad, showing its structure, components, and improvement opportunities.

**Usage:**
```bash
@squad-creator

*analyze-squad my-squad
# â†’ Full analysis of my-squad

*analyze-squad my-squad --verbose
# â†’ Detailed analysis with file contents

*analyze-squad my-squad --suggestions
# â†’ Include AI-powered suggestions
```

**Output:**
- Squad overview (name, version, author)
- Component inventory (tasks, agents, etc.)
- Dependency analysis
- Coverage metrics (what directories are empty)
- Improvement suggestions

### 2. `*extend-squad` - Add/Modify Components

**Purpose:** Interactively add new components to an existing squad.

**Usage:**
```bash
@squad-creator

*extend-squad my-squad
# â†’ Interactive mode, asks what to add

*extend-squad my-squad --add agent
# â†’ Add new agent

*extend-squad my-squad --add task --agent my-agent
# â†’ Add new task for specific agent

*extend-squad my-squad --add workflow
# â†’ Add new workflow

*extend-squad my-squad --story SQS-XX
# â†’ Link changes to story
```

**Components Supported:**
| Component | Flag | Creates |
|-----------|------|---------|
| Agent | `--add agent` | `agents/{name}.md` |
| Task | `--add task` | `tasks/{agent}-{task}.md` |
| Workflow | `--add workflow` | `workflows/{name}.md` |
| Checklist | `--add checklist` | `checklists/{name}.md` |
| Template | `--add template` | `templates/{name}.md` |
| Tool | `--add tool` | `tools/{name}.js` |
| Script | `--add script` | `scripts/{name}.js` |
| Data | `--add data` | `data/{name}.yaml` |

---

## Service Type

**Recommendation:** Utility Service (Internal tasks + scripts)

**Rationale:**
- No external API integration needed
- Filesystem operations only
- Follows existing squad-creator patterns
- Integrates with existing validator/loader

---

## Suggested Structure

### New Task Files

```
.aios-core/development/tasks/
â”œâ”€â”€ squad-creator-analyze.md     # NEW: *analyze-squad
â””â”€â”€ squad-creator-extend.md      # NEW: *extend-squad
```

### New Script Files

```
.aios-core/development/scripts/squad/
â”œâ”€â”€ squad-analyzer.js            # NEW: Analysis logic
â””â”€â”€ squad-extender.js            # NEW: Extension logic
```

### Updated Files

```
.aios-core/development/agents/squad-creator.md  # Add new commands
.aios-core/schemas/squad-schema.json            # (no changes needed)
```

---

## Implementation Steps

### Phase 1: Analysis Task (4-6h)

1. **Create `squad-creator-analyze.md`**
   - Define task format (TASK-FORMAT-SPECIFICATION-V1)
   - Elicitation: squad name, output format
   - Steps: scan, analyze, report

2. **Create `squad-analyzer.js`**
   - `analyzeSquad(squadPath)` â†’ returns analysis object
   - Component inventory
   - Coverage metrics
   - Dependency check

3. **Add Tests**
   - `tests/unit/squad/squad-analyzer.test.js`
   - Target: 80%+ coverage

### Phase 2: Extension Task (6-8h)

4. **Create `squad-creator-extend.md`**
   - Define task format
   - Elicitation: component type, name, details
   - Steps: validate, create, update manifest, validate again

5. **Create `squad-extender.js`**
   - `addAgent(squadPath, agentDef)`
   - `addTask(squadPath, taskDef)`
   - `addTemplate(squadPath, templateDef)`
   - etc. for each component type
   - Auto-update squad.yaml

6. **Add Tests**
   - `tests/unit/squad/squad-extender.test.js`
   - Target: 80%+ coverage

### Phase 3: Agent Integration (2-3h)

7. **Update `squad-creator.md`**
   - Add `*analyze-squad` command
   - Add `*extend-squad` command
   - Update dependencies section

8. **Sync to IDE Rules**
   - Run sync script for .claude, .cursor, etc.

### Phase 4: Documentation (2-3h)

9. **Update Documentation**
   - Update `docs/guides/squads-guide.md`
   - Add examples to squad-examples/
   - Update epic-sqs-squad-system.md

10. **Create Story**
    - `docs/stories/v2.1/sprint-XX/story-sqs-11-squad-improvement.md`

---

## Detailed Task Specifications

### `squad-creator-analyze.md`

```yaml
task: analyzeSquad()
responsible: squad-creator (Craft)
responsible_type: Agent
atomic_layer: Analysis
elicit: true

inputs:
- field: squad_name
  type: string
  source: User Input
  required: true
  validation: Squad exists in ./squads/

- field: output_format
  type: string
  source: User Input
  required: false
  validation: console|markdown|json

outputs:
- field: analysis_report
  type: object
  destination: Console or file
  persisted: false
```

**Output Example:**
```
=== Squad Analysis: my-domain-squad ===

ğŸ“‹ Overview
  Name: my-domain-squad
  Version: 1.0.0
  Author: John Doe
  License: MIT

ğŸ“¦ Components
  â”œâ”€â”€ Agents (2)
  â”‚   â”œâ”€â”€ lead-agent.md
  â”‚   â””â”€â”€ helper-agent.md
  â”œâ”€â”€ Tasks (3)
  â”‚   â”œâ”€â”€ lead-agent-task1.md
  â”‚   â”œâ”€â”€ lead-agent-task2.md
  â”‚   â””â”€â”€ helper-agent-task1.md
  â”œâ”€â”€ Workflows (0) â† Empty
  â”œâ”€â”€ Templates (1)
  â”‚   â””â”€â”€ report-template.md
  â”œâ”€â”€ Tools (0) â† Empty
  â””â”€â”€ Checklists (0) â† Empty

ğŸ“Š Coverage
  Tasks: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80% (3/4 agents have tasks)
  Docs: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100% (README exists)
  Config: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 80% (tech-stack missing)

ğŸ’¡ Suggestions
  1. Add checklist for agent validation
  2. Create workflow for common agent sequences
  3. Add tech-stack.md to config/
```

### `squad-creator-extend.md`

```yaml
task: extendSquad()
responsible: squad-creator (Craft)
responsible_type: Agent
atomic_layer: Modification
elicit: true

inputs:
- field: squad_name
  type: string
  source: User Input
  required: true

- field: component_type
  type: string
  source: User Input
  required: true
  validation: agent|task|workflow|checklist|template|tool|script|data

- field: component_name
  type: string
  source: User Input
  required: true
  validation: kebab-case

- field: story_id
  type: string
  source: User Input
  required: false
  validation: SQS-XX format

outputs:
- field: created_file
  type: string
  destination: Squad directory
  persisted: true

- field: updated_manifest
  type: boolean
  destination: squad.yaml
  persisted: true
```

---

## Agent Assignment

| Role | Agent | Responsibilities |
|------|-------|------------------|
| Primary | @dev (Dex) | Implement scripts and tasks |
| Support | @qa (Quinn) | Test implementation |
| Review | @architect (Aria) | Architecture review |

---

## Dependencies

### Runtime Dependencies
- Node.js 18+
- Existing squad scripts (loader, validator, generator)

### Development Dependencies
- Jest (testing)
- js-yaml (YAML parsing)

---

## Effort Estimate

| Phase | Effort | Dependencies |
|-------|--------|--------------|
| Phase 1: Analysis Task | 4-6h | SQS-4 (done) |
| Phase 2: Extension Task | 6-8h | Phase 1 |
| Phase 3: Agent Integration | 2-3h | Phase 2 |
| Phase 4: Documentation | 2-3h | Phase 3 |
| **Total** | **14-20h** | |

---

## Story Integration

### Proposed Story: SQS-11

**Title:** Squad Analyze & Extend Tasks

**Epic:** SQS (Squad System Enhancement)

**Sprint:** Sprint 14 (or next available)

**Acceptance Criteria:**
- [ ] `*analyze-squad` shows complete squad inventory
- [ ] `*extend-squad` can add all component types
- [ ] Automatic squad.yaml update on extension
- [ ] Validation runs after extension
- [ ] Optional --story flag for traceability
- [ ] 80%+ test coverage
- [ ] Documentation updated

---

## Next Steps

1. **Review and approve** this approach
2. **Create Story SQS-11** in `docs/stories/v2.1/sprint-XX/`
3. **Run `*create-service squad-analyzer`** to scaffold (or manual creation)
4. **Begin implementation** with @dev

---

## Alternative Approaches Considered

### Option A: Single `*improve-squad` Task (Not Recommended)
- Combines analyze + extend in one task
- Too complex, violates single responsibility
- Hard to test

### Option B: Multiple Granular Tasks (Not Recommended)
- `*add-agent`, `*add-task`, `*add-workflow`, etc.
- Too many commands to remember
- Inconsistent user experience

### Option C: Two Tasks - Analyze + Extend (Recommended âœ…)
- Clear separation of concerns
- Analyze first, then extend
- Consistent with existing patterns

---

**Created by:** @architect (Aria)
**Date:** 2025-12-26
**Status:** Pending Approval

---

*Next: Create Story SQS-11 or proceed with implementation*
